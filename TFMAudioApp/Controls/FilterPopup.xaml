<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               x:Class="TFMAudioApp.Controls.FilterPopup"
               Color="Transparent">

    <Border BackgroundColor="{StaticResource CardBackgroundColor}"
            StrokeThickness="0"
            Padding="20"
            MinimumWidthRequest="340"
            MaximumWidthRequest="400">
        <Border.StrokeShape>
            <RoundRectangle CornerRadius="20"/>
        </Border.StrokeShape>

        <VerticalStackLayout Spacing="16">
            <!-- Header -->
            <Grid ColumnDefinitions="*,Auto">
                <Label Text="Filters"
                       FontSize="22"
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>
                <Button Grid.Column="1"
                        Text="X"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Gray400}"
                        FontSize="20"
                        WidthRequest="44"
                        HeightRequest="44"
                        Clicked="OnCloseClicked"/>
            </Grid>

            <!-- Show Folders -->
            <Border BackgroundColor="{StaticResource Gray600}"
                    StrokeThickness="0"
                    Padding="16,12"
                    StrokeShape="RoundRectangle 12">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <Label Text="ðŸ“"
                           FontSize="20"
                           VerticalOptions="Center"/>
                    <Label Grid.Column="1"
                           Text="Show Folders"
                           FontSize="16"
                           VerticalOptions="Center"
                           Margin="12,0,0,0"/>
                    <Switch x:Name="ShowFoldersSwitch"
                            Grid.Column="2"
                            IsToggled="True"
                            OnColor="{StaticResource Primary}"/>
                </Grid>
            </Border>

            <!-- Audio Extensions -->
            <Grid ColumnDefinitions="*,Auto">
                <Label Text="Audio Formats"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray300}"
                       VerticalOptions="Center"/>
                <Button x:Name="ClearAllFormatsButton"
                        Grid.Column="1"
                        Text="Clear All"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Primary}"
                        FontSize="13"
                        Padding="8,4"
                        Clicked="OnClearAllFormatsClicked"/>
            </Grid>

            <FlexLayout x:Name="ExtensionsContainer"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start">
                <!-- Extensions will be added dynamically -->
            </FlexLayout>

            <!-- Sort Options -->
            <Label Text="Sort By"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="{StaticResource Gray300}"
                   Margin="0,8,0,0"/>

            <FlexLayout x:Name="SortOptionsContainer"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start">
                <!-- Sort options will be added dynamically -->
            </FlexLayout>

            <!-- Sort Direction -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Border x:Name="AscendingBorder"
                        BackgroundColor="{StaticResource Gray600}"
                        StrokeThickness="0"
                        Padding="12,10"
                        StrokeShape="RoundRectangle 10">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnAscendingTapped"/>
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                        <Label Text="â†‘" FontSize="16" VerticalOptions="Center"/>
                        <Label Text="Ascending" FontSize="14" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Border>
                <Border x:Name="DescendingBorder"
                        Grid.Column="1"
                        BackgroundColor="{StaticResource Primary}"
                        StrokeThickness="0"
                        Padding="12,10"
                        StrokeShape="RoundRectangle 10">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnDescendingTapped"/>
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                        <Label Text="â†“" FontSize="16" VerticalOptions="Center"/>
                        <Label Text="Descending" FontSize="14" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Border>
            </Grid>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,12,0,0">
                <Button Text="Reset All"
                        BackgroundColor="{StaticResource Gray600}"
                        TextColor="White"
                        CornerRadius="12"
                        HeightRequest="48"
                        FontSize="15"
                        Clicked="OnResetClicked"/>
                <Button Grid.Column="1"
                        Text="Apply Filters"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="12"
                        HeightRequest="48"
                        FontSize="15"
                        FontAttributes="Bold"
                        Clicked="OnApplyClicked"/>
            </Grid>
        </VerticalStackLayout>
    </Border>
</toolkit:Popup>
