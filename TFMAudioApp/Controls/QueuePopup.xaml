<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:models="clr-namespace:TFMAudioApp.Models"
               xmlns:behaviors="clr-namespace:TFMAudioApp.Behaviors"
               x:Class="TFMAudioApp.Controls.QueuePopup"
               Color="Transparent">

    <Border BackgroundColor="{StaticResource CardBackgroundColor}"
            StrokeThickness="0"
            Padding="0"
            WidthRequest="360"
            HeightRequest="500">
        <Border.StrokeShape>
            <RoundRectangle CornerRadius="24"/>
        </Border.StrokeShape>

        <Grid RowDefinitions="Auto,Auto,*,Auto">
            <!-- Header -->
            <Grid Grid.Row="0" Padding="20,20,20,10" ColumnDefinitions="*,Auto">
                <VerticalStackLayout>
                    <Label Text="Queue"
                           FontSize="24"
                           FontAttributes="Bold"/>
                    <Label x:Name="QueueCountLabel"
                           FontSize="14"
                           TextColor="{StaticResource Gray400}"/>
                </VerticalStackLayout>
                <Button Grid.Column="1"
                        Text="âœ•"
                        BackgroundColor="Transparent"
                        TextColor="{StaticResource Gray400}"
                        FontSize="20"
                        WidthRequest="44"
                        HeightRequest="44"
                        Clicked="OnCloseClicked"/>
            </Grid>

            <!-- Now Playing Section -->
            <Border Grid.Row="1"
                    BackgroundColor="{StaticResource Primary}"
                    StrokeThickness="0"
                    Padding="16"
                    Margin="16,0"
                    StrokeShape="RoundRectangle 12"
                    Opacity="0.9">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                    <Label Text="ðŸŽµ"
                           FontSize="28"
                           VerticalOptions="Center"/>
                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                        <Label Text="NOW PLAYING"
                               FontSize="10"
                               FontAttributes="Bold"
                               CharacterSpacing="1"
                               TextColor="#CCFFFFFF"/>
                        <Label x:Name="CurrentTrackLabel"
                               FontSize="15"
                               FontAttributes="Bold"
                               LineBreakMode="TailTruncation"
                               TextColor="White"/>
                        <Label x:Name="CurrentArtistLabel"
                               FontSize="12"
                               TextColor="#AAFFFFFF"
                               LineBreakMode="TailTruncation"/>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Queue List -->
            <CollectionView Grid.Row="2"
                            x:Name="QueueList"
                            Margin="0,12,0,0">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="0"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Track">
                        <Border BackgroundColor="Transparent"
                                StrokeThickness="0"
                                Padding="16,12"
                                Margin="8,2"
                                StrokeShape="RoundRectangle 10">
                            <Border.Behaviors>
                                <behaviors:TapFeedbackBehavior/>
                            </Border.Behaviors>
                            <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="12">
                                <Label Text="{Binding Order, StringFormat='{0}.'}"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray500}"
                                       WidthRequest="24"
                                       VerticalOptions="Center"/>
                                <Label Grid.Column="1"
                                       Text="ðŸŽµ"
                                       FontSize="20"
                                       VerticalOptions="Center"/>
                                <VerticalStackLayout Grid.Column="2" VerticalOptions="Center">
                                    <Label Text="{Binding DisplayName}"
                                           FontSize="14"
                                           LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding ChannelName}"
                                           FontSize="12"
                                           TextColor="{StaticResource Gray400}"
                                           LineBreakMode="TailTruncation"/>
                                </VerticalStackLayout>
                                <Label Grid.Column="3"
                                       Text="{Binding DurationFormatted}"
                                       FontSize="12"
                                       TextColor="{StaticResource Gray400}"
                                       VerticalOptions="Center"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center"
                                         VerticalOptions="Center"
                                         Padding="40">
                        <Label Text="ðŸ“­"
                               FontSize="48"
                               HorizontalOptions="Center"/>
                        <Label Text="Queue is empty"
                               FontSize="16"
                               TextColor="{StaticResource Gray400}"
                               HorizontalOptions="Center"
                               Margin="0,10"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>

            <!-- Actions -->
            <Grid Grid.Row="3" Padding="16" ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Text="Clear Queue"
                        BackgroundColor="{StaticResource Gray600}"
                        TextColor="White"
                        CornerRadius="12"
                        HeightRequest="48"
                        Clicked="OnClearQueueClicked"/>
                <Button Grid.Column="1"
                        Text="Shuffle"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="12"
                        HeightRequest="48"
                        Clicked="OnShuffleClicked"/>
            </Grid>
        </Grid>
    </Border>
</toolkit:Popup>
