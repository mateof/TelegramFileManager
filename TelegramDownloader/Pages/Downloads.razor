@page "/downloads"

@using TelegramDownloader.Data
@using TelegramDownloader.Models
@using TelegramDownloader.Services

@inject TransactionInfoService tis

<div class="downloads-header">
    <h2 class="downloads-title">
        <i class="bi bi-cloud-arrow-down-fill"></i>
        Tasks Manager
    </h2>
    <div class="stats-summary">
        <div class="stat-card">
            <div class="stat-icon pending">
                <i class="bi bi-clock-history"></i>
            </div>
            <div class="stat-info">
                <h4>@tis.getTotalTasks()</h4>
                <p>Pending Tasks</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon downloads">
                <i class="bi bi-download"></i>
            </div>
            <div class="stat-info">
                <h4>@tis.getTotalDownloads(false)</h4>
                <p>Downloads</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon uploads">
                <i class="bi bi-upload"></i>
            </div>
            <div class="stat-info">
                <h4>@tis.getTotalUploads()</h4>
                <p>Uploads</p>
            </div>
        </div>
    </div>
</div>

<Tabs>
    <Tab Title="Pending Tasks" IsActive="true">
        <Content>
            <div class="tab-actions">
                <span class="tab-actions-title">Actions</span>
                <div class="action-btn-group">
                    <button class="action-btn clear" @onclick="clearTasks" title="Clear completed and error">
                        <i class="bi bi-trash3"></i>
                        <span>Clear</span>
                    </button>
                </div>
            </div>

            <TelegramDownloader.Pages.Partials.TasksTable></TelegramDownloader.Pages.Partials.TasksTable>
        </Content>
    </Tab>
    <Tab Title="Downloads">
        <Content>
            <div class="tab-actions">
                <span class="tab-actions-title">Actions</span>
                <div class="action-btn-group">
                    <button class="action-btn clear" @onclick="clearDownloads" title="Clear completed and error">
                        <i class="bi bi-trash3"></i>
                        <span>Clear</span>
                    </button>
                    @if (tis.isPauseDownloads)
                    {
                        <button class="action-btn play" @onclick="() => tis.PlayDownloads()" title="Resume downloads">
                            <i class="bi bi-play-fill"></i>
                            <span>Play</span>
                        </button>
                    }
                    else
                    {
                        <button class="action-btn pause" @onclick="() => tis.PauseDownloads()" title="Pause downloads">
                            <i class="bi bi-pause-fill"></i>
                            <span>Pause</span>
                        </button>
                    }
                    <button class="action-btn stop" @onclick="() => tis.StopDownloads()" title="Stop all downloads">
                        <i class="bi bi-stop-fill"></i>
                        <span>Stop</span>
                    </button>
                </div>
            </div>
            <Tabs>
                <Tab Title="Active">
                    <Content>
                        <TelegramDownloader.Pages.Partials.DownloadsTable isPending="false"></TelegramDownloader.Pages.Partials.DownloadsTable>
                    </Content>
                </Tab>
                <Tab Title="Queue">
                    <Content>
                        <TelegramDownloader.Pages.Partials.DownloadsTable isPending="true"></TelegramDownloader.Pages.Partials.DownloadsTable>
                    </Content>
                </Tab>
            </Tabs>
        </Content>
    </Tab>
    <Tab Title="Uploads">
        <Content>
            <div class="tab-actions">
                <span class="tab-actions-title">Actions</span>
                <div class="action-btn-group">
                    <button class="action-btn clear" @onclick="clearUploads" title="Clear completed and error">
                        <i class="bi bi-trash3"></i>
                        <span>Clear</span>
                    </button>
                </div>
            </div>
            <TelegramDownloader.Pages.Partials.UploadsTable></TelegramDownloader.Pages.Partials.UploadsTable>
        </Content>
    </Tab>
</Tabs>


@code {
    protected override async Task OnInitializedAsync()
    {
    }

    
    async Task clearUploads()
    {
        tis.clearUploadCompleted();
    }

    async Task clearDownloads()
    {
        tis.clearDownloadCompleted();
    }

    async Task clearTasks()
    {
        tis.clearTasksCompleted();
    }

    
    
}
